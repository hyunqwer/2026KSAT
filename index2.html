<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>윤선생 커리큘럼: 2026 수능 적중 분석 리포트</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- FontAwesome (for icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts (Noto Sans KR) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <!-- Chosen Palette: Warm Professional & Academic Excellence
         Background: #FAFAF9 (Stone 50) - Warm, paper-like neutral
         Primary Text: #44403C (Stone 700)
         Accent/Brand: #D97706 (Amber 600) - Symbolizing Gold/Excellence/Success
         Secondary: #78716C (Stone 500)
         Card Bg: #FFFFFF (White)
    -->
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #FAFAF9;
            color: #44403C;
        }
        
        /* Chart Container Styling - MANDATORY Compliance */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Constraint for large screens */
            height: 300px;   /* Base height */
            max-height: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Custom Scrollbar for list areas */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f5f5f4; 
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #d6d3d1; 
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; 
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>

    <!-- Application Structure Plan: 
         1. Header/Hero: Establishes credibility with the "100% Match" claim and navigation.
         2. Dashboard Overview: High-level quantitative view using Charts (Topic Distribution & Coverage Balance).
         3. Interactive Evidence Explorer: The core interactive element.
            - Left Panel: Filterable list of CSAT Question Types (Listening/Reading).
            - Right Panel: Detailed view showing the CSAT Requirement vs. MULTIPLE Yoon Textbook Extracts.
            - User Flow: Select Mode (L/R) -> Filter Category -> Click Question -> Read Proof.
         4. Key Strengths: Qualitative summary cards (Real-life, Academic, Critical Thinking).
         
         Rationale: This structure leads the user from the "Promise" (Hero) to the "Proof" (Explorer) to the "Value" (Strengths).
    -->

    <!-- Visualization & Content Choices:
         1. Doughnut Chart: To show the balanced distribution of topics (Daily Life, Science, Logic, etc.).
         2. Bar Chart: To visualize the volume of matches across Listening and Reading.
         3. Interactive List & Card View: Replaces the long static table. Allows users to focus on one question type at a time while seeing all related textbook extracts.
         
         CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. Charts rendered via Chart.js Canvas.
    -->
</head>
<body class="antialiased selection:bg-amber-100 selection:text-amber-900 flex flex-col min-h-screen">

    <!-- Navigation -->
    <header class="bg-white border-b border-stone-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
                <i class="fa-solid fa-graduation-cap text-amber-600 text-2xl"></i>
                <h1 class="font-bold text-xl tracking-tight text-stone-800">윤선생 <span class="text-amber-600">수능 적중</span> 리포트</h1>
            </div>
            <nav class="hidden md:flex space-x-8">
                <button onclick="scrollToSection('dashboard')" class="text-stone-600 hover:text-amber-600 font-medium transition text-sm">대시보드</button>
                <button onclick="scrollToSection('explorer')" class="text-stone-600 hover:text-amber-600 font-medium transition text-sm">적중 증명 탐색기</button>
                <button onclick="scrollToSection('analysis')" class="text-stone-600 hover:text-amber-600 font-medium transition text-sm">핵심 강점</button>
            </nav>
            <button class="md:hidden text-stone-600" onclick="alert('데스크탑 화면에서 최적의 경험을 제공합니다.')">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>
    </header>

    <main class="flex-grow">
        <!-- Hero Section -->
        <section class="bg-gradient-to-b from-amber-50 to-stone-50 py-16 px-4 text-center relative overflow-hidden">
            <!-- Decorative BG elements -->
            <div class="absolute top-0 left-0 w-full h-full overflow-hidden opacity-10 pointer-events-none">
                <i class="fa-solid fa-quote-right absolute top-10 left-10 text-9xl text-amber-300 transform -rotate-12"></i>
                <i class="fa-solid fa-check-double absolute bottom-10 right-10 text-9xl text-amber-300 transform rotate-12"></i>
            </div>

            <div class="max-w-4xl mx-auto space-y-6 relative z-10">
                <div class="inline-flex items-center px-4 py-1.5 bg-white border border-amber-200 text-amber-700 rounded-full text-sm font-bold shadow-sm mb-4">
                    <span class="w-2 h-2 bg-amber-500 rounded-full mr-2 animate-pulse"></span>
                    2026학년도 수능 영어 완벽 대비
                </div>
                <h2 class="text-4xl md:text-5xl lg:text-6xl font-black text-stone-900 leading-tight tracking-tight">
                    수능 영어, 우연이 아닌 필연!<br>
                    <span class="text-amber-600 relative inline-block">
                        100% 유사 소재
                        <svg class="absolute w-full h-3 -bottom-1 left-0 text-amber-200 -z-10" viewBox="0 0 100 10" preserveAspectRatio="none"><path d="M0 5 Q 50 10 100 5" stroke="currentColor" stroke-width="8" fill="none" /></svg>
                    </span>를 증명하다
                </h2>
                <p class="text-lg text-stone-600 max-w-2xl mx-auto leading-relaxed pt-4">
                    2026 수능 영어의 모든 영역 소재가 윤선생 교재에 이미 존재했습니다.
                    데이터로 증명된 윤선생 커리큘럼의 압도적인 적중률을 직접 확인하세요.
                </p>
                <div class="pt-8 flex flex-col sm:flex-row justify-center gap-4">
                    <button onclick="scrollToSection('explorer')" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3.5 px-8 rounded-xl shadow-lg shadow-amber-200 transform transition hover:-translate-y-1 flex items-center justify-center">
                        <i class="fa-solid fa-magnifying-glass mr-2"></i> 적중 사례 확인하기
                    </button>
                    <button onclick="scrollToSection('dashboard')" class="bg-white hover:bg-stone-50 text-stone-700 font-bold py-3.5 px-8 rounded-xl border border-stone-200 shadow-sm transform transition hover:-translate-y-1">
                        데이터 분석 보기
                    </button>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard" class="py-16 px-4 max-w-7xl mx-auto">
            <div class="mb-10 text-center">
                <h3 class="text-2xl font-bold text-stone-800 mb-3 relative inline-block">
                    커리큘럼 소재 분석 대시보드
                    <span class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-12 h-1 bg-amber-500 rounded"></span>
                </h3>
                <p class="text-stone-600 max-w-3xl mx-auto mt-4">
                    이 섹션에서는 윤선생 교재가 다루고 있는 주제의 다양성과 수능 문항과의 연계성을 시각적으로 보여줍니다. 
                    일상적인 대화부터 고난도 학술 지문까지, 윤선생 커리큘럼은 수능이 요구하는 모든 스펙트럼을 포괄하고 있습니다.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Chart 1: Topic Distribution -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100 flex flex-col">
                    <div class="flex items-center justify-between mb-6">
                        <h4 class="text-lg font-bold text-stone-700 border-l-4 border-amber-500 pl-3">주제별 커버리지 분포</h4>
                        <span class="text-xs font-medium text-stone-400 bg-stone-100 px-2 py-1 rounded">다양성 분석</span>
                    </div>
                    <div class="chart-container flex-grow">
                        <canvas id="topicChart"></canvas>
                    </div>
                    <p class="text-xs text-stone-500 mt-4 text-center bg-stone-50 py-2 rounded">
                        * 듣기와 읽기 전 영역에 걸쳐 인문, 사회, 과학, 예술 등 다양한 소재가 균형 있게 배치되어 있습니다.
                    </p>
                </div>

                <!-- Chart 2: Question Type Count -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100 flex flex-col">
                    <div class="flex items-center justify-between mb-6">
                        <h4 class="text-lg font-bold text-stone-700 border-l-4 border-amber-500 pl-3">영역별 문항 매칭 현황</h4>
                        <span class="text-xs font-medium text-stone-400 bg-stone-100 px-2 py-1 rounded" id="dashboardTotalCount">총 45문항 대비</span>
                    </div>
                    <div class="chart-container flex-grow">
                        <canvas id="typeChart"></canvas>
                    </div>
                    <p class="text-xs text-stone-500 mt-4 text-center bg-stone-50 py-2 rounded" id="dashboardBreakdown">
                        * 듣기(17) / 읽기(28) 전체 문항에 대해 유사 소재가 확인되었습니다.
                    </p>
                </div>
            </div>
        </section>

        <!-- Explorer Section (Core Feature) -->
        <section id="explorer" class="py-16 px-4 bg-stone-100 border-t border-stone-200">
            <div class="max-w-7xl mx-auto">
                <div class="mb-8">
                    <h3 class="text-2xl font-bold text-stone-800 mb-2">
                        <i class="fa-solid fa-layer-group text-amber-600 mr-2"></i>적중 증명 탐색기 (Evidence Explorer)
                    </h3>
                    <p class="text-stone-600 text-sm md:text-base">
                        아래 탐색기를 통해 실제 수능 문항 소재와 윤선생 교재의 지문(Source Extract)을 직접 비교해보세요.
                        <span class="font-semibold text-amber-700">하나의 수능 문항에 대해 여러 개의 교재 지문이 매칭된 사례</span>를 모두 확인할 수 있습니다.
                    </p>
                </div>

                <!-- Controls Toolbar -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-200 mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <!-- Toggle Buttons -->
                    <div class="bg-stone-100 p-1 rounded-lg flex w-full md:w-auto">
                        <button id="btn-listening" onclick="setMode('Listening')" class="flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all shadow-sm bg-white text-amber-600 border border-stone-200">
                            <i class="fa-solid fa-headphones mr-2"></i>듣기 (Listening)
                        </button>
                        <button id="btn-reading" onclick="setMode('Reading')" class="flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all text-stone-500 hover:text-stone-700 hover:bg-stone-200">
                            <i class="fa-solid fa-book-open mr-2"></i>읽기 (Reading)
                        </button>
                    </div>
                    
                    <!-- Filter Dropdown -->
                    <div class="relative w-full md:w-72">
                        <label for="categoryFilter" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-stone-400 text-xs font-bold uppercase pointer-events-none">Filter:</label>
                        <select id="categoryFilter" onchange="filterData()" class="w-full pl-16 pr-10 py-2.5 border border-stone-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-amber-500 bg-white text-stone-700 cursor-pointer text-sm font-medium shadow-sm hover:border-amber-400 transition-colors">
                            <option value="All">모든 카테고리 보기</option>
                            <!-- Options populated by JS -->
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-stone-500">
                            <i class="fa-solid fa-chevron-down text-xs"></i>
                        </div>
                    </div>
                </div>

                <!-- Main Explorer Split View -->
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-[600px] lg:h-[700px]">
                    
                    <!-- Left Column: Item List (Modified height constraints) -->
                    <div class="lg:col-span-4 bg-white rounded-xl border border-stone-200 shadow-sm flex flex-col overflow-hidden h-full min-h-[300px]">
                        <div class="p-4 bg-stone-50 border-b border-stone-200 flex justify-between items-center">
                            <span class="font-bold text-stone-700 text-sm"><i class="fa-solid fa-list-ul mr-2"></i>문항 리스트</span>
                            <span id="matchCount" class="text-xs bg-amber-100 text-amber-700 px-2.5 py-1 rounded-full font-bold">0건</span>
                        </div>
                        <div id="itemList" class="overflow-y-auto p-2 space-y-2 custom-scroll flex-1 bg-stone-50/50">
                            <!-- Items populated by JS -->
                        </div>
                    </div>

                    <!-- Right Column: Details View -->
                    <div class="lg:col-span-8 h-full">
                        <div id="detailView" class="bg-white rounded-xl border border-amber-100 shadow-md h-full flex flex-col relative overflow-hidden">
                            <!-- Default State -->
                            <div id="emptyState" class="absolute inset-0 flex flex-col items-center justify-center text-stone-400 bg-stone-50 z-10 p-8 text-center">
                                <div class="w-20 h-20 bg-stone-200 rounded-full flex items-center justify-center mb-4 text-stone-400">
                                    <i class="fa-regular fa-hand-pointer text-3xl"></i>
                                </div>
                                <h4 class="text-lg font-bold text-stone-600 mb-2">문항을 선택해주세요</h4>
                                <p class="text-sm">왼쪽 리스트에서 수능 문항 유형을 선택하면<br>상세한 윤선생 교재 적중 사례를 확인할 수 있습니다.</p>
                            </div>

                            <!-- Content State -->
                            <div id="contentState" class="hidden h-full flex flex-col">
                                <!-- Sticky Header -->
                                <div class="p-6 border-b border-stone-100 bg-white z-20 shadow-sm">
                                    <div class="flex items-start justify-between">
                                        <div>
                                            <span id="detailBadge" class="inline-block px-2.5 py-0.5 bg-stone-100 text-stone-600 rounded text-xs font-bold mb-2 uppercase tracking-wide border border-stone-200">Category</span>
                                            <h3 id="detailTitle" class="text-2xl font-black text-stone-800 leading-none mb-2">문항 제목</h3>
                                            <div class="flex items-center text-amber-600 font-medium text-sm">
                                                <i class="fa-solid fa-bullseye mr-2"></i>
                                                <span id="detailTopic">유사 소재: ...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Scrollable Content -->
                                <div class="overflow-y-auto custom-scroll p-6 space-y-8 flex-1 bg-stone-50/30">
                                    
                                    <!-- Section 1: CSAT Context -->
                                    <div class="relative">
                                        <div class="absolute -left-3 top-0 bottom-0 w-1 bg-stone-300 rounded-full"></div>
                                        <h5 class="text-sm font-bold text-stone-500 uppercase mb-3 flex items-center pl-4">
                                            <i class="fa-solid fa-file-contract mr-2"></i> 수능 출제 경향 및 소재
                                        </h5>
                                        <div class="bg-white p-5 rounded-lg border border-stone-200 shadow-sm ml-1">
                                            <p id="detailContext" class="text-stone-800 leading-relaxed font-medium">
                                                이 유형은 ...
                                            </p>
                                        </div>
                                    </div>

                                    <!-- Section 2: Yoon Source Matches -->
                                    <div class="relative">
                                        <div class="absolute -left-3 top-0 bottom-0 w-1 bg-amber-500 rounded-full"></div>
                                        <h5 class="text-sm font-bold text-amber-700 uppercase mb-3 flex items-center pl-4">
                                            <i class="fa-solid fa-book-bookmark mr-2"></i> 윤선생 교재 적중 증거 (Source Extracts)
                                        </h5>
                                        
                                        <!-- Container for dynamic Matches -->
                                        <div id="matchesContainer" class="space-y-4 ml-1">
                                            <!-- Dynamic cards injected here -->
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analysis Section -->
        <section id="analysis" class="py-16 px-4 max-w-7xl mx-auto">
            <div class="mb-12 text-center">
                <h3 class="text-2xl font-bold text-stone-800 mb-3">영역별 핵심 강점</h3>
                <p class="text-stone-600">
                    단순한 문제 풀이가 아닙니다. 윤선생 커리큘럼은 배경지식과 사고력을 동시에 확장합니다.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Card 1 -->
                <div class="group bg-white p-8 rounded-2xl shadow-sm border border-stone-100 hover:border-amber-200 hover:shadow-lg transition-all duration-300">
                    <div class="w-14 h-14 bg-amber-50 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-amber-100 transition-colors">
                        <i class="fa-solid fa-earth-americas text-amber-600 text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-bold text-stone-800 mb-3 group-hover:text-amber-700 transition-colors">실생활 완벽 대비</h4>
                    <p class="text-stone-600 text-sm leading-relaxed">
                        <span class="font-semibold text-stone-800 block mb-2">"약속, 쇼핑, 길 찾기 등 일상 대화가 곧 수능!"</span>
                        실생활 중심의 대화문으로 듣기 영역의 기초부터 실전까지 만점을 준비합니다.
                    </p>
                </div>

                <!-- Card 2 -->
                <div class="group bg-white p-8 rounded-2xl shadow-sm border border-stone-100 hover:border-amber-200 hover:shadow-lg transition-all duration-300">
                    <div class="w-14 h-14 bg-amber-50 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-amber-100 transition-colors">
                        <i class="fa-solid fa-microscope text-amber-600 text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-bold text-stone-800 mb-3 group-hover:text-amber-700 transition-colors">전문 지식 함양</h4>
                    <p class="text-stone-600 text-sm leading-relaxed">
                        <span class="font-semibold text-stone-800 block mb-2">"과학, 경제, 기술 등 최신 학술 주제"</span>
                        변인 통제, 한계 효용 등 전문 용어와 개념이 포함된 지문을 미리 접하여 독해의 깊이를 더합니다.
                    </p>
                </div>

                <!-- Card 3 -->
                <div class="group bg-white p-8 rounded-2xl shadow-sm border border-stone-100 hover:border-amber-200 hover:shadow-lg transition-all duration-300">
                    <div class="w-14 h-14 bg-amber-50 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-amber-100 transition-colors">
                        <i class="fa-solid fa-brain text-amber-600 text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-bold text-stone-800 mb-3 group-hover:text-amber-700 transition-colors">비판적 사고 완성</h4>
                    <p class="text-stone-600 text-sm leading-relaxed">
                        <span class="font-semibold text-stone-800 block mb-2">"예술 해석, 법과 자유, 미디어 비판"</span>
                        단순 해석을 넘어 문맥 속에 숨겨진 의미를 파악하는 고난도 추론 능력을 길러줍니다.
                    </p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-400 py-12 border-t border-stone-800">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <div class="flex items-center justify-center gap-2 mb-6 text-stone-200">
                <i class="fa-solid fa-graduation-cap text-2xl"></i>
                <span class="font-bold text-xl">윤선생 영어교실</span>
            </div>
            <p class="mb-6 text-sm leading-relaxed">
                본 리포트는 2026학년도 대학수학능력시험 영어 영역 문항과<br>윤선생 커리큘럼 교재 내 지문의 소재 유사성을 분석한 결과입니다.
            </p>
            <div class="text-xs text-stone-600">
                &copy; 2025 YOON'S ENGLISH SCHOOL. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Script Logic -->
    <script>
        // --- 1. Data Source (Updated for 2026 CSAT) ---
        // Category Assignment (Simplified for Charting):
        // 일상/생활: Daily life, health, shopping, travel, simple tasks
        // 사회/인문: Psychology, ethics, culture, art, economics, society
        // 학술/과학: Technology, environment, biology, physics, brain/memory
        // 정보/안내: Rules, notices, detailed information, graphs
        // 기타/감정: Emotions, feelings, personal change
        const curriculumData = [
            // --- Listening (17 Questions) ---
            { 
                id: 'L1', section: 'Listening', type: '1. 목적 파악', category: '일상/생활', topic: '수면 유도 앱 광고', 
                context: '수면 및 휴식의 중요성 강조', 
                matches: [
                    { text: "You should rest and sleep more.", source: "s09 SMART 중학영어 1학년(2학기)" },
                    { text: "Music will help you to sleep.", source: "s09 SMART 중학영어 1학년(2학기)" }
                ]
            },
            { 
                id: 'L2', section: 'Listening', type: '2. 의견 파악', category: '일상/생활', topic: '실내 암벽 등반의 이점', 
                context: '스포츠 활동 다양성과 운동의 건강 효과', 
                matches: [
                    { text: "Activities include whitewater rafting and backpacking, as well as rock climbing, caving, and mountain biking.", source: "s12 Yoon's Word Partners 1~6" },
                    { text: "Exercise keeps your body strong.", source: "s12 Yoon's Word Partners 1~6" }
                ]
            },
            { 
                id: 'L3', section: 'Listening', type: '3. 요지 파악', category: '사회/인문', topic: '큰 포즈와 불안 완화', 
                context: '신체 언어와 감정 표현의 연관성', 
                matches: [
                    { text: "A person who walks with his or her chin high is confident or proud.", source: "s11 Advanced Readers D 8b 1~3" },
                    { text: "Most people show their real thoughts and emotions through body language.", source: "s11 Advanced Readers D 8b 1~3" }
                ]
            },
            { 
                id: 'L4', section: 'Listening', type: '4. 그림 내용 일치', category: '일상/생활', topic: '철도 박물관 사진', 
                context: '플랫폼·기차 내부 묘사', 
                matches: [
                    { text: "His father stood nearby on the railroad loading platform. Erskine climbed the high metal steps into the train car.", source: "s12 Yoon's Chapter Books 1~5" },
                    { text: "Erskine walked between rows of seats, each wide enough for two people.", source: "s12 Yoon's Chapter Books 1~5" }
                ]
            },
            { 
                id: 'L5', section: 'Listening', type: '5. 할 일 파악', category: '일상/생활', topic: '홈메이드 파이 가게 준비', 
                context: '구매해야 할 재료·리스트 점검', 
                matches: [
                    { text: "What else do we need to buy? Oh, don't forget milk.", source: "s11 SMART 중학영어 2학년(2학기)" },
                    { text: "Did you buy everything on the shopping list? I think so. Bacon, bread, and cheese.", source: "s08 POWERUP 1-1 1~2" }
                ]
            },
            { 
                id: 'L6', section: 'Listening', type: '6. 숫자 정보 파악', category: '일상/생활', topic: '전기 히터와 슬리퍼 구매', 
                context: '가격 비교·할인 계산', 
                matches: [
                    { text: "It was $50 before, but now it's only $25. Is it 50% off?", source: "s08 POWERUP 1-1 1~2" },
                    { text: "I'll take the bag and the hat... The total price was nine dollars.", source: "s08 POWERUP 1-1 1~2" }
                ]
            },
            { 
                id: 'L7', section: 'Listening', type: '7. 이유 파악', category: '기타/감정', topic: 'Morning Tea Club 불참', 
                context: '일정 충돌 또는 건강 문제', 
                matches: [
                    { text: "I have an appointment to see her at two o'clock, but I won't be able to make it.", source: "s12 윤선생 수능 project(전략편) 1~3" },
                    { text: "I am in bed with the flu.", source: "s12 윤선생 수능 project(전략편) 1~3" }
                ]
            },
            { 
                id: 'L8', section: 'Listening', type: '8. 언급 유무 파악', category: '정보/안내', topic: 'Autumn Treasure Hunt 행사 정보', 
                context: '행사 정보(상품·날짜·장소 등)', 
                matches: [
                    { text: "The winner gets a 32GB media player! You can apply via our school website or talk to Ms. Kim.", source: "s11 Advanced Readers D 8b 1~3" },
                    { text: "The Warriors will play at the Tigers' school. What day is the basketball game? Friday, November 10", source: "s08 English Immersion P.E. 1-2" }
                ]
            },
            { 
                id: 'L9', section: 'Listening', type: '9. 담화 세부 내용 파악', category: '정보/안내', topic: 'Court Visit Program 안내', 
                context: '이용 시 금지 사항·제한 사항', 
                matches: [
                    { text: "Children under 140 cm are not allowed to ride.", source: "s11 SMART 중학영어 2학년(2학기)" },
                    { text: "Do not touch anything. ... Make sure you don't take pictures.", source: "s08 SMART 중학영어 1학년(1학기)" }
                ]
            },
            { 
                id: 'L10', section: 'Listening', type: '10. 표 내용 파악', category: '정보/안내', topic: '버터나이프 세트 선택', 
                context: '조건 비교 후 선택', 
                matches: [
                    { text: "Which do you prefer, blue or green? I prefer blue. And what size would you like? I'd like a medium, please.", source: "s13 SMART 중학영어 3학년(2학기) book5~8" },
                    { text: "I'd like one that weighs less than 1.5 kilograms... costs less than 800 dollars.", source: "s12 Yoon's Word Partners 1~6" }
                ]
            },
            { 
                id: 'L11', section: 'Listening', type: '11. 적절한 응답 고르기', category: '일상/생활', topic: '아이 픽업 지연 상황', 
                context: '늦은 사유 설명·도움 요청', 
                matches: [
                    { text: "Mom picked me up late from soccer practice. She was stuck in traffic.", source: "s11 Yoon's Writing Solutions A" },
                    { text: "Can you help me with this math problem? Of course. It's easy. I can help you.", source: "s10 Yoon's Reading PALS B 8a" }
                ]
            },
            { 
                id: 'L12', section: 'Listening', type: '12. 적절한 응답 고르기', category: '일상/생활', topic: '수학여행 장소 선택', 
                context: '장소 제안·교통 비교', 
                matches: [
                    { text: "Where would you like to go? How about Jeju-do? We can swim at the beach and climb up Hallasan Mountain.", source: "s10 SMART 중학영어 2학년(1학기)" },
                    { text: "The bus is a lot faster than the train. Let’s hurry.", source: "s11 SMART 중학영어 2학년(2학기)" }
                ]
            },
            { 
                id: 'L13', section: 'Listening', type: '13. 적절한 응답 고르기', category: '일상/생활', topic: 'DIY 의자 키트 부품 손상', 
                context: '환불·교환 요구', 
                matches: [
                    { text: "I bought this bag yesterday, but there is a problem with it. ... I was wondering if I could get a refund.", source: "s08 SMART 중학영어 1학년(1학기)" },
                    { text: "I have a complaint about this bag. What's the problem? There's a small rip down there.", source: "s13 POWERUP 3-2 1~2" }
                ]
            },
            { 
                id: 'L14', section: 'Listening', type: '14. 적절한 응답 고르기', category: '일상/생활', topic: '자녀의 편식 문제 해결 조언', 
                context: '올바른 식습관에 대한 조언', 
                matches: [
                    { text: "You should eat healthy foods, like fruits and vegetables. Please stay away from candy and junk food.", source: "s09 SMART 중학영어 1학년(2학기)" },
                    { text: "You'd better not eat too much fast food. Also you'd better exercise daily.", source: "s10 SMART 중학영어 2학년(1학기)" }
                ]
            },
            { 
                id: 'L15', section: 'Listening', type: '15. 상황에 적절한 말', category: '일상/생활', topic: '자전거 경로 지도 제작 방법', 
                context: '활동 제안 표현', 
                matches: [
                    { text: "Why don't we go to the rock music festival...?", source: "s08 POWERUP 1-1 1~2" },
                    { text: "How about playing baseball?", source: "s10 POWERUP 2-1 1~2" },
                    { text: "Why don't we go shopping?", source: "s08 POWERUP 1-1 1~2" }
                ]
            },
            { 
                id: 'L16', section: 'Listening', type: '16~17. 담화 주제', category: '학술/과학', topic: '과학 실험에 유용한 빠르게 자라는 식물들', 
                context: '식물 성장 속도·관찰', 
                matches: [
                    { text: "Some types of bamboo can grow almost a meter in just one day!", source: "s09 SMART 중학영어 1학년(2학기)" },
                    { text: "Mom, look at the chicory! The leaves are big.", source: "s11 SMART 중학영어 2학년(2학기)" }
                ]
            },
            
            // --- Reading (28 Questions) ---
            { 
                id: 'R18', section: 'Reading', type: '18. 목적 파악', category: '정보/안내', topic: '신규 동아리 개설 제안서 요청', 
                context: '동아리 가입 권유', 
                matches: [
                    { text: "Let's all join the English Drama Club together! Sure, that's a good idea.", source: "s08 SMART 중학영어 1학년(1학기)" },
                    { text: "The Baking Club Wants You! [...] Come and join us.", source: "s08 SMART 중학영어 1학년(1학기)" }
                ]
            },
            { 
                id: 'R19', section: 'Reading', type: '19. 심경 변화 파악', category: '기타/감정', topic: '오랜만에 고향 방문', 
                context: '혼란·놀람 등 감정 변화', 
                matches: [
                    { text: "I was very confused.", source: "s08 English Immersion P.E. 1-2" },
                    { text: "She looked surprised. Then, she smiled at Kevin.", source: "s11 Yoon's Word Partners 1~6" }
                ]
            },
            { 
                id: 'R20', section: 'Reading', type: '20. 필자의 주장 파악', category: '사회/인문', topic: '현대 음악 작사가의 문학적 기여 인정', 
                context: '음악 가사의 문학적 가치', 
                matches: [
                    { text: "Rock lyrics are known for expressing freedom.", source: "s10 Yoon's Advanced Readers D 8a" }
                ]
            },
            { 
                id: 'R21', section: 'Reading', type: '21. 함축 의미 추론', category: '학술/과학', topic: '디지털 플랫폼과 장소의 연결 약화', 
                context: '시간·공간 제약 해소', 
                matches: [
                    { text: "There are no barriers of time and space in cyberspace.", source: "s10 윤선생 완소 단어장 B book1~2" },
                    { text: "You can buy anything through the Internet. [...] You can buy everything from your own room.", source: "s08 POWERUP 1-1 1~2" }
                ]
            },
            { 
                id: 'R22', section: 'Reading', type: '22. 요지 파악', category: '사회/인문', topic: '스포츠 생태계의 협조적 경쟁 관리', 
                context: '스포츠 윤리·팀워크', 
                matches: [
                    { text: "It doesn't matter if you win or lose. It's how you play the game.", source: "s08 English Immersion P.E. 1-2" },
                    { text: "Anne and I were playing especially well. We helped each other. It was great teamwork!", source: "s08 English Immersion P.E. 1-2" }
                ]
            },
            { 
                id: 'R23', section: 'Reading', type: '23. 주제 추론', category: '일상/생활', topic: '대중교통에서 빈도의 중요성', 
                context: '운행 간격의 의미', 
                matches: [
                    { text: "The airport limousines leave at twenty-minute intervals.", source: "s12 윤선생 완소 단어장 C book1~2" }
                ]
            },
            { 
                id: 'R24', section: 'Reading', type: '24. 제목 추론', category: '사회/인문', topic: '컬처테인먼트의 상업화 위험', 
                context: '광고의 상업성·영향', 
                matches: [
                    { text: "Makers of products spend millions of dollars a year on ads,", source: "s10 POWERUP 2-1 1~2" },
                    { text: "Television commercials are the best way to advertise things in the United States.", source: "s08 Yoon's Reading Solutions A 7a" }
                ]
            },
            { 
                id: 'R25', section: 'Reading', type: '25. 도표 내용 일치 파악', category: '정보/안내', topic: '미국 십 대의 친구와 시간 보내기 비율', 
                context: '청소년 활동·습관 통계', 
                matches: [
                    { text: "The graph shows the use of mobile phone by teens.", source: "s11 SMART 중학영어 2학년(2학기)" },
                    { text: "I am seventeen year old American.", source: "s14 English Immersion American culture 1~2" }
                ]
            },
            { 
                id: 'R26', section: 'Reading', type: '26. 글의 세부 내용 파악', category: '사회/인문', topic: 'Max Kleiber에 대한 정보', 
                context: '인물 정보·업적', 
                matches: [
                    { text: "Heo Jun was a famous Korean doctor. [...] He was born in Neunggok in 1546.", source: "s10 English Immersion Famous People 1~2" },
                    { text: "Heo Jun spent fifteen years writing about Eastern medicine.", source: "s300627" }
                ]
            },
            { 
                id: 'R27', section: 'Reading', type: '27. 안내문 세부 내용 파악', category: '정보/안내', topic: '학교 종소리 경연 대회', 
                context: '교내 행사 안내·시상', 
                matches: [
                    { text: "We are holding our 4th English Song Contest next week. [...] The winner gets a 32GB media player!", source: "s11 SMART 중학영어 2학년(2학기)" },
                    { text: "The student president votes were counted on Wednesday.", source: "s12 Yoon's Writing Solutions A" }
                ]
            },
            { 
                id: 'R28', section: 'Reading', type: '28. 안내문 세부 내용 파악', category: '정보/안내', topic: 'Fun Bowling 시즌 패스', 
                context: '시설 이용료 및 패스 조건', 
                matches: [
                    { text: "Tickets are 5.00foroneperson∗∗or∗∗9.00 for a couple.", source: "s09 English Immersion Holidays 1~2" },
                    { text: "The bowling alley rented shoes to us. It did not cost a lot of money to rent shoes for the day.", source: "s08 English Immersion P.E. 1-2" }
                ]
            },
            { 
                id: 'R29', section: 'Reading', type: '29. 문법성 판단', category: '학술/과학', topic: '인간 지능과 적응적 정보 축적', 
                context: '뇌 기능과 기억 구조', 
                matches: [
                    { text: "The brain is the most complicated organ of the human body.", source: "s12 Yoon's Reading PALS C 9a" },
                    { text: "Humans have short-term memory and long-term memory.", source: "s11 SMART 중학영어 2학년(2학기)" }
                ]
            },
            { 
                id: 'R30', section: 'Reading', type: '30. 어휘의 적절성 파악', category: '사회/인문', topic: '상황 윤리의 적용', 
                context: '경쟁·정직의 가치 판단', 
                matches: [
                    { text: "I wasn't really safe. Why are the boy's teammates so happy? [...] Being honest can be a difficult decision", source: "s08 English Immersion P.E. 1-2" },
                    { text: "It doesn't matter if you win or lose. It's how you play the game.", source: "s08 English Immersion P.E. 1-2" }
                ]
            },
            { 
                id: 'R31', section: 'Reading', type: '31. 빈칸 추론', category: '사회/인문', topic: '초기 곡물 무역 회사의 위험 관리', 
                context: '사업 기회와 전문 지식', 
                matches: [
                    { text: "Whatever you enjoy, if you look for practical applications, you could turn your interest into a profitable business opportunity.", source: "s14 Yoon's Reading PALS D 10a" },
                    { text: "start the way Bill Gates did - by learning everything you can about your area of expertise.", source: "s14 Yoon's Reading PALS D 10a" }
                ]
            },
            { 
                id: 'R32', section: 'Reading', type: '32. 빈칸 추론', category: '사회/인문', topic: '글쓰기에서의 협력적 문체', 
                context: '의사소통·오해', 
                matches: [
                    { text: "Communication is the overlap between what's intended and what's understood.", source: "s13 Yoon's Reading Solutions C 9b" },
                    { text: "read it again and imagine you are the person receiving it. Could the words be read by the receiver in the wrong way?", source: "s13 POWERUP 3-2 1~2" }
                ]
            },
            { 
                id: 'R33', section: 'Reading', type: '33. 빈칸 추론', category: '학술/과학', topic: '건물 설계 시 사용자 참여의 중요성', 
                context: '사용자 편의를 위한 설계', 
                matches: [
                    { text: "Smart houses can also serve much more practical purposes. Disabled or elderly people may be able to live more independently with the aid of a smart house.", source: "s15 Yoon's Advanced Readers F 10b" },
                    { text: "An architect must be able to design a building that is safe practical and attractive.", source: "s15 Yoon's Reading PALS D 10b" }
                ]
            },
            { 
                id: 'R34', section: 'Reading', type: '34. 빈칸 추론', category: '사회/인문', topic: '칸트의 법의 지배와 자유', 
                context: '법과 규칙의 역할 및 보호 기능', 
                matches: [
                    { text: "The use of your seat belt is required by law. The seat belt protects the passenger.", source: "s12 Yoon's Advanced Readers E 9a" },
                    { text: "If you don't obey the laws, you will go to jail.", source: "s09 English Immersion Holidays 1~2" }
                ]
            },
            { 
                id: 'R35', section: 'Reading', type: '35. 무관한 문장 찾기', category: '일상/생활', topic: '자기관리 활동의 우선순위', 
                context: '스트레스 관리 및 건강한 습관', 
                matches: [
                    { text: "It's easier to handle stress when you do things you like. [...] Just talking about your feeling with friends will help.", source: "s13 SMART 중학영어 3학년(2학기) book5~8" },
                    { text: "I am so tired. I can’t focus on this work. You should take a rest.", source: "s10 SMART 중학영어 2학년(1학기)" }
                ]
            },
            { 
                id: 'R36', section: 'Reading', type: '36. 글의 순서 파악', category: '학술/과학', topic: '시계의 본질로서의 반복적 과정', 
                context: '시간 측정 역사·원리', 
                matches: [
                    { text: "The Babylonians used a system of counting based on the number 60. Both the Indian and the Chinese counting systems were based on the number 10.", source: "s14 Yoon's Reading Solutions D 10a" },
                    { text: "Now we have clocks that can measure time in nanoseconds! They are called atomic clocks.", source: "s11 Reading PALS B 8b 1~2" }
                ]
            },
            { 
                id: 'R37', section: 'Reading', type: '37. 글의 순서 파악', category: '학술/과학', topic: '철학의 역할과 신경과학과의 협력', 
                context: '뇌 기능과 학문 간 연관성', 
                matches: [
                    { text: "The left side of the body controlled by the left brain... The right brain works with feelings and imagination.", source: "s12 Yoon's Advanced Readers E 9a" },
                    { text: "Philosophy is the study of general values we have such as existence and truth.", source: "s12 Yoon's Debate Project" }
                ]
            },
            { 
                id: 'R38', section: 'Reading', type: '38. 주어진 문장 넣기', category: '사회/인문', topic: '내러티브의 형성 및 영향', 
                context: '이야기의 힘, 구전', 
                matches: [
                    { text: "You learned from your experience. Your experience is your own personal history.", source: "s10 Yoon's Advanced Readers D 8a" },
                    { text: "We can also learn from the history of people who lived before us.", source: "s10 Yoon's Advanced Readers D 8a" }
                ]
            },
            { 
                id: 'R39', section: 'Reading', type: '39. 주어진 문장 넣기', category: '학술/과학', topic: '비디오 게임에서의 지각과 행동', 
                context: '게임 중독 및 디지털 활동', 
                matches: [
                    { text: "I can't stop playing computer games.", source: "s10 POWERUP 2-1 1~2" },
                    { text: "Internet game addiction is very dangerous... Internet game addiction destroys human relations.", source: "s13 Yoon's Reading Solutions C 9b" },
                    { text: "You can play games, watch movies, and read comics on the Internet.", source: "s13 SMART 중학영어 3학년(2학기) book5~8" }
                ]
            },
            { 
                id: 'R40', section: 'Reading', type: '40. 요약문 완성', category: '사회/인문', topic: '공연 예술의 특성과 경제적 불안정', 
                context: '라이브 공연의 가치·비용', 
                matches: [
                    { text: "Tickets sometimes cost more than a week's wages... People return to the same show time after time because they become involved in the enthusiasm of a live performance.", source: "s14 English Immersion American culture 1~2" },
                    { text: "The money will be used for a new stage, sound equipment, props, and costumes.", source: "s09 Yoon's Writing Solutions A" }
                ]
            },
            { 
                id: 'R41', section: 'Reading', type: '41~42. 장문', category: '사회/인문', topic: '복식사 연구에서 시각 자료의 중요성', 
                context: '복식과 사회적 지위·패션', 
                matches: [
                    { text: "The color of the toga also indicated the man's rank in society.", source: "s12 Yoon's Reading PALS C 9a" },
                    { text: "Some people like to stay up-to-date with today's fashion.", source: "s12 Yoon's Reading PALS C 9a" }
                ]
            },
            { 
                id: 'R43', section: 'Reading', type: '43~45. 장문', category: '일상/생활', topic: '스마트폰 중독 딸과의 유대감 회복', 
                context: '기술 통제의 중요성·가족 갈등', 
                matches: [
                    { text: "Please turn off your devices and put them in this basket. Just remember, you should be in control of your devices...", source: "s12 SMART 중학영어 3학년(1학기)" },
                    { text: "My mom took my cellphone. [...] And that made her upset?", source: "s12 POWERUP 3-1 1~2" }
                ]
            },
            { 
                id: 'R44', section: 'Reading', type: '43~45. 장문 (지칭)', category: '일상/생활', topic: '스마트폰 중독 딸과의 유대감 회복', 
                context: '규칙 준수·관계 회복 필요성', 
                matches: [
                    { text: "You shouldn't use your cellphone during class.", source: "s10 SMART 중학영어 2학년(1학기)" },
                    { text: "My brother always does the same thing. I'm still upset. I don't know what I should do.", source: "s10 SMART 중학영어 2학년(1학기)" }
                ]
            },
            { 
                id: 'R45', section: 'Reading', type: '43~45. 장문 (세부 사실)', category: '일상/생활', topic: '스마트폰 중독 딸과의 유대감 회복', 
                context: '독서를 통한 학습·가족의 염려', 
                matches: [
                    { text: "Reading helps you build better and more logical thinking skills.", source: "s2661" },
                    { text: "My parents were concerned about me and tried many different things, but nothing really worked.", source: "s13 Yoon's Reading PALS C 9b" }
                ]
            }
        ];

        // --- 2. State & Logic ---
        let currentMode = 'Listening'; // 'Listening' or 'Reading'
        let currentFilter = 'All';
        let selectedItemId = null;
        
        // --- Core Utility Function for Question Counting ---
        function getQuestionCount(type) {
            // Updated to handle split long questions R43, R44, R45
            if (type.includes('43~45')) return 1;
            const match = type.match(/(\d+)~?(\d*)/);
            if (!match) return 1; 
            const start = parseInt(match[1]);
            const end = parseInt(match[2] || match[1]);
            return end - start + 1;
        }

        function init() {
            renderCharts();
            populateFilters();
            renderList();
            
            // Auto-select first item
            const firstItem = curriculumData.find(item => item.section === currentMode);
            if(firstItem) selectItem(firstItem.id);
        }

        function setMode(mode) {
            currentMode = mode;
            currentFilter = 'All'; 
            
            // Update UI buttons styling
            const btnList = document.getElementById('btn-listening');
            const btnRead = document.getElementById('btn-reading');
            
            // Reset base styles
            const activeStyle = "bg-white text-amber-600 shadow-sm border border-stone-200";
            const inactiveStyle = "text-stone-500 hover:text-stone-700 hover:bg-stone-200";

            if(mode === 'Listening') {
                btnList.className = `flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all ${activeStyle}`;
                btnRead.className = `flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all ${inactiveStyle}`;
            } else {
                btnList.className = `flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all ${inactiveStyle}`;
                btnRead.className = `flex-1 md:flex-none px-6 py-2 rounded-md text-sm font-bold transition-all ${activeStyle}`;
            }

            populateFilters();
            renderList();
            
            // Auto-select first
            const firstItem = curriculumData.find(item => item.section === mode);
            if(firstItem) selectItem(firstItem.id);
            else {
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('contentState').classList.add('hidden');
            }
        }

        function populateFilters() {
            const select = document.getElementById('categoryFilter');
            select.innerHTML = '<option value="All">모든 카테고리 보기</option>';
            
            // Get unique categories for current mode
            const categories = [...new Set(curriculumData
                .filter(item => item.section === currentMode)
                .map(item => item.category))];
            
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
            
            select.value = currentFilter;
        }

        function filterData() {
            currentFilter = document.getElementById('categoryFilter').value;
            renderList();
        }

        function renderList() {
            const listContainer = document.getElementById('itemList');
            listContainer.innerHTML = '';

            const filtered = curriculumData.filter(item => {
                const modeMatch = item.section === currentMode;
                const filterMatch = currentFilter === 'All' || item.category === currentFilter;
                return modeMatch && filterMatch;
            });

            // Calculate total matched questions for the current filter/mode
            let totalMatchedQuestions = 0;
            filtered.forEach(item => {
                totalMatchedQuestions += getQuestionCount(item.type);
            });

            document.getElementById('matchCount').textContent = `${totalMatchedQuestions} 문항 (${filtered.length} 유형)`;

            if (filtered.length === 0) {
                listContainer.innerHTML = '<div class="p-8 text-center text-stone-400 text-sm flex flex-col items-center"><i class="fa-regular fa-folder-open text-2xl mb-2"></i>해당 조건의 데이터가 없습니다.</div>';
                return;
            }

            filtered.forEach(item => {
                const el = document.createElement('div');
                const isSelected = selectedItemId === item.id;
                
                // Styling
                let baseClass = "p-3 rounded-lg cursor-pointer transition-all border text-left group relative overflow-hidden";
                if(isSelected) {
                    baseClass += " bg-white border-amber-500 shadow-md transform scale-[1.02] z-10";
                } else {
                    baseClass += " bg-white border-transparent hover:bg-white hover:border-stone-300 hover:shadow-sm";
                }

                el.className = baseClass;
                el.onclick = () => selectItem(item.id);
                
                // Question count for list item
                const qCount = getQuestionCount(item.type);

                // Multiple matches indicator
                const matchCountBadge = item.matches.length > 1 
                    ? `<span class="ml-2 text-[10px] bg-stone-100 text-stone-500 px-1.5 rounded border border-stone-200" title="${item.matches.length}개의 교재 지문 매칭">+${item.matches.length} Sources</span>` 
                    : '';
                    
                const qCountDisplay = qCount > 1 
                    ? `<span class="text-[10px] bg-stone-100 text-stone-600 px-1.5 rounded border border-stone-200">${qCount}Q</span>` 
                    : '';


                el.innerHTML = `
                    <div class="flex justify-between items-start mb-1">
                        <span class="text-xs font-bold ${isSelected ? 'text-amber-600' : 'text-stone-500 group-hover:text-stone-700'}">${item.type}</span>
                        <span class="text-[10px] px-2 py-0.5 rounded-full bg-stone-100 text-stone-500 border border-stone-100">${item.category}</span>
                    </div>
                    <div class="font-bold text-sm text-stone-800 line-clamp-1 group-hover:text-amber-600 transition-colors">${item.topic}</div>
                    <div class="mt-1 flex items-center gap-1">
                         ${qCountDisplay} ${matchCountBadge}
                    </div>
                    ${isSelected ? '<div class="absolute left-0 top-0 bottom-0 w-1 bg-amber-500"></div>' : ''}
                `;
                listContainer.appendChild(el);
            });
        }

        function selectItem(id) {
            selectedItemId = id;
            renderList(); // Re-render list to update active states

            const item = curriculumData.find(d => d.id === id);
            if (!item) return;

            // Toggle Views
            document.getElementById('emptyState').classList.add('hidden');
            const content = document.getElementById('contentState');
            content.classList.remove('hidden');
            
            // Animation reset
            content.classList.remove('fade-in');
            void content.offsetWidth; 
            content.classList.add('fade-in');

            // Populate Content Header
            document.getElementById('detailBadge').textContent = item.category;
            document.getElementById('detailTitle').textContent = item.type;
            document.getElementById('detailTopic').textContent = `유사 소재: ${item.topic}`;
            document.getElementById('detailContext').textContent = item.context;

            // Populate Matches (Multiple Source Extracts)
            const matchesContainer = document.getElementById('matchesContainer');
            matchesContainer.innerHTML = ''; // Clear previous

            item.matches.forEach((match, index) => {
                const card = document.createElement('div');
                card.className = "bg-amber-50 p-5 rounded-lg border border-amber-200 shadow-sm relative group hover:shadow-md transition-shadow";
                
                // Strip redundant Korean descriptions in parentheses for clean display
                const cleanText = match.text.replace(/\s*\([^)]*\)/g, '').trim();

                card.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-xs font-bold text-white bg-amber-500 px-2 py-0.5 rounded uppercase tracking-wider">Proof ${index + 1}</span>
                        <span class="text-xs font-mono text-stone-500 bg-white px-2 py-1 rounded border border-stone-200 shadow-sm group-hover:text-amber-700 group-hover:border-amber-200 transition-colors">
                            <i class="fa-solid fa-book mr-1"></i>${match.source}
                        </span>
                    </div>
                    <p class="font-serif text-lg text-stone-800 leading-relaxed italic relative z-10 pl-4 border-l-2 border-amber-300">
                        "${cleanText}"
                    </p>
                    <i class="fa-solid fa-quote-right absolute bottom-4 right-4 text-4xl text-amber-200/50 -z-0"></i>
                `;
                matchesContainer.appendChild(card);
            });
        }

        function scrollToSection(id) {
            const element = document.getElementById(id);
            if(element) {
                const headerOffset = 80;
                const elementPosition = element.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                window.scrollTo({ top: offsetPosition, behavior: "smooth" });
            }
        }

        function renderCharts() {
            // Data Prep
            const categoryCounts = {};
            
            // Calculate total matched questions by category (individual questions)
            let totalListeningQuestions = 0;
            let totalReadingQuestions = 0;

            curriculumData.forEach(item => {
                const questionCount = getQuestionCount(item.type);
                const category = item.category;
                
                categoryCounts[category] = (categoryCounts[category] || 0) + questionCount;
                
                if (item.section === 'Listening') {
                    totalListeningQuestions += questionCount;
                } else if (item.section === 'Reading') {
                    totalReadingQuestions += questionCount;
                }
            });
            
            const totalQuestionCount = totalListeningQuestions + totalReadingQuestions;

            // 1. Topic Distribution (Doughnut)
            const ctxTopic = document.getElementById('topicChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.topicChartInstance) window.topicChartInstance.destroy();

            window.topicChartInstance = new Chart(ctxTopic, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryCounts),
                    datasets: [{
                        data: Object.values(categoryCounts),
                        backgroundColor: [
                            '#f59e0b', // Amber 500 (일상/생활)
                            '#3b82f6', // Blue 500 (사회/인문)
                            '#10b981', // Emerald 500 (학술/과학)
                            '#8b5cf6', // Violet 500 (정보/안내)
                            '#ef4444', // Red 500 (기타/감정)
                        ],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom', 
                            labels: { boxWidth: 12, padding: 20, font: { family: 'Noto Sans KR', size: 11 } } 
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.label}: ${context.raw}문항`;
                                }
                            },
                            backgroundColor: 'rgba(68, 64, 60, 0.9)', 
                            padding: 12
                        }
                    },
                    cutout: '65%'
                }
            });

            // 2. Type Count (Bar)
            const ctxType = document.getElementById('typeChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.typeChartInstance) window.typeChartInstance.destroy();

            window.typeChartInstance = new Chart(ctxType, {
                type: 'bar',
                data: {
                    labels: [`듣기 (${totalListeningQuestions}문항)`, `읽기 (${totalReadingQuestions}문항)`],
                    datasets: [{
                        label: '적중 문항 수',
                        data: [totalListeningQuestions, totalReadingQuestions],
                        backgroundColor: ['#d97706', '#57534e'], // Amber 600, Stone 600
                        borderRadius: 6,
                        barThickness: 50
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            max: 30,
                            grid: { display: true, drawBorder: false, color: '#f5f5f4' },
                            ticks: { font: { family: 'Noto Sans KR' } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { family: 'Noto Sans KR', weight: 'bold' } }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(68, 64, 60, 0.9)',
                            padding: 10
                        }
                    }
                }
            });
            
            // Update static counts in dashboard text
            document.getElementById('dashboardTotalCount').textContent = `총 ${totalQuestionCount}문항 대비`;
            document.getElementById('dashboardBreakdown').textContent = `* 듣기(${totalListeningQuestions}) / 읽기(${totalReadingQuestions}) 전체 문항에 대해 유사 소재가 확인되었습니다.`;
        }

        // Initialize on load
        window.addEventListener('load', init);

    </script>
</body>
</html>
